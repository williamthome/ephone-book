<header>
  <h2>EPhoneBook</h2>
</header>
<main class="container">
  <form onsubmit="return doSubmit(event)">
    <label>
      Name:
      <input type="text" name="name" required>
    </label>
    <label>
      Phone:
      <input type="text" name="phone" required>
    </label>
    <input class="primary-button" type="submit" value="Add">
  </form>
  <ul id="contact-list">
    ~s
  </ul>
</main>

<script>
  document
    .getElementById("contact-list")
    .addEventListener("click", async (e) => {
      const { target: { dataset: { action, contactId } } } = e

      const fnByTargetAction = {
        "delete": async () => {
          if (!confirm(
            `Confirm delete the contact with id ${contactId}?`
          )) return

          await doFetch(fetch(`/api/contacts/${contactId}`, {
            method: "delete",
          }))
        }
      }

      const actionFn = fnByTargetAction[action]
      actionFn && await actionFn()
    })

  async function doSubmit(e) {
    e.preventDefault()

    await doFetch(fetch("/api/contacts", {
      method: "post",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded"
      },
      body: encodeFormData(e.target),
    }))
  }
</script>