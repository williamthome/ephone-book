<main>
  <h2>My contacts list</h2>
  <form onsubmit="return doSubmit(event)">
    <label>
      Name:
      <input type="text" name="name">
    </label>
    <label>
      Phone:
      <input type="text" name="phone">
    </label>
    <input type="submit" value="Add">
  </form>
  <ul id="contacts-list">
    ~ts
  </ul>
</main>

<script>
  document
    .getElementById("contacts-list")
    .addEventListener("click", e => {
      const { target } = e

      const actionByTargetId = {
        "contact-delete": () => {
          const { contactId } = target.dataset

          if (!confirm(
            `Confirm delete the contact with id ${contactId}?`
          )) return

          alert("TODO: Delete the contact")
        }
      }

      const action = actionByTargetId[target.id]
      action && action()
    })

  async function doSubmit(e) {
    e.preventDefault()

    try {
      const response = await fetch("/api/contacts", {
        method: "post",
        headers: {
          "Content-Type": "application/x-www-form-urlencoded"
        },
        body: encodeFormData(e.target),
      })

      if (!response.ok) throw response

      location.reload()
    } catch (e) {
      console.error(e)
      alert("Something bad happened. Check the console for more info.")
    }
  }

  function encodeFormData(formElement) {
    const data = new URLSearchParams()
    for (const [key, value] of new FormData(formElement)) {
      data.append(key, value)
    }
    return data.toString()
  }
</script>